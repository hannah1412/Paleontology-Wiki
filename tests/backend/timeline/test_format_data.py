from backend import timeline

def test_gives_list():
    '''Test the function returns the correct data type'''
    data = {"head": {"vars": ['id', 'label', 'startTime', 'endTime', 'rankLabel', 'firstParentLabel', 'firstImgURL']}, 
        "results": {"bindings": 
            [
            {'id': {'type': 'literal', 'value': 'Q123245'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Leptoceratopsidae'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-83500000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'family'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Neoceratopsia'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'}}, 
            {'id': {'type': 'literal', 'value': 'Q129290'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaea'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-199600000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-33900000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaeidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'}}, 
            {'id': {'type': 'literal', 'value': 'Q130921'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisaurus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisauridae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'}}, 
            {'id': {'type': 'literal', 'value': 'Q129300'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-189000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}}
            ]
            }}
    result = timeline.format_data(data)
    assert type(result) == list

def test_gives_right_format():
    '''Test the function returns the correct formatted data with full id, label, startTime, endTime, rankLabel, firstParentLabel and firstImgURL.'''
    data = {"head": {"vars": ['id', 'label', 'startTime', 'endTime', 'rankLabel', 'firstParentLabel', 'firstImgURL']}, 
            "results": {"bindings": 
                [
                {'id': {'type': 'literal', 'value': 'Q123245'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Leptoceratopsidae'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-83500000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'family'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Neoceratopsia'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q129290'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaea'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-199600000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-33900000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaeidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q130921'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisaurus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisauridae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'}}, 
                {'id': {'type': 'literal', 'value': 'Q129300'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-189000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}}
                ]
                }}
    result = timeline.format_data(data)

    expected_result = [{'id': 'Q123245', 'label': 'Leptoceratopsidae', 'startTime': '-83500000-01-01T00:00:00Z', 'rankLabel': 'family', 'firstParentLabel': 'Neoceratopsia', 'endTime': '-66000000-01-01T00:00:00Z', 'imgURL' : 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'},
                       {'id': 'Q129290', 'label': 'Gryphaea', 'startTime': '-199600000-01-01T00:00:00Z','rankLabel':'genus', 'firstParentLabel': 'Gryphaeidae', 'endTime': '-33900000-01-01T00:00:00Z', 'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'},
                       {'id': 'Q130921', 'label': 'Abelisaurus', 'startTime': '-80000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Abelisauridae', 'endTime': '-80000000-01-01T00:00:00Z',  'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'},
                       {'id': 'Q129300', 'label': 'Inoceramus', 'startTime': '-189000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Inoceramidae','endTime': '-66000000-01-01T00:00:00Z',  'imgURL':'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}]
    
    assert result == expected_result

def test_gives_right_format_without_URL():
    '''Test the function returns the correct formatted data with missing URL.'''
    data = {"head": {"vars": ['id', 'label', 'startTime', 'endTime', 'rankLabel', 'firstParentLabel', 'firstImgURL']}, 
            "results": {"bindings": 
                [
                {'id': {'type': 'literal', 'value': 'Q123245'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Leptoceratopsidae'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-83500000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'family'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Neoceratopsia'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q129290'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaea'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-199600000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-33900000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaeidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q130921'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisaurus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisauridae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'}}, 
                {'id': {'type': 'literal', 'value': 'Q129300'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-189000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramidae'}}
                ]
                }}
    result = timeline.format_data(data)

    expected_result = [{'id': 'Q123245', 'label': 'Leptoceratopsidae', 'startTime': '-83500000-01-01T00:00:00Z', 'rankLabel': 'family', 'firstParentLabel': 'Neoceratopsia', 'endTime': '-66000000-01-01T00:00:00Z', 'imgURL' : 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'},
                       {'id': 'Q129290', 'label': 'Gryphaea', 'startTime': '-199600000-01-01T00:00:00Z','rankLabel':'genus', 'firstParentLabel': 'Gryphaeidae', 'endTime': '-33900000-01-01T00:00:00Z', 'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'},
                       {'id': 'Q130921', 'label': 'Abelisaurus', 'startTime': '-80000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Abelisauridae', 'endTime': '-80000000-01-01T00:00:00Z',  'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'},
                       {'id': 'Q129300', 'label': 'Inoceramus', 'startTime': '-189000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Inoceramidae','endTime': '-66000000-01-01T00:00:00Z',  'imgURL':None}]
    
    assert result == expected_result

def test_gives_right_format_without_endtime():
    '''Test the function returns the correct formatted data with missing endTime.'''
    data = {"head": {"vars": ['id', 'label', 'startTime', 'endTime', 'rankLabel', 'firstParentLabel', 'firstImgURL']}, 
            "results": {"bindings": 
                [
                {'id': {'type': 'literal', 'value': 'Q123245'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Leptoceratopsidae'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-83500000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'family'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Neoceratopsia'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q129290'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaea'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-199600000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-33900000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaeidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q130921'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisaurus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisauridae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'}}, 
                {'id': {'type': 'literal', 'value': 'Q131298'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Aardonyx'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-195000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Anchisauria'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Aardonyx%20NT.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q129300'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-189000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramidae'},'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}}
                ]
                }}
    result = timeline.format_data(data)

    # Aardonyx last because it has no endTime, so the format_data algorithm will add it last
    expected_result = [{'id': 'Q123245', 'label': 'Leptoceratopsidae', 'startTime': '-83500000-01-01T00:00:00Z', 'rankLabel': 'family', 'firstParentLabel': 'Neoceratopsia', 'endTime': '-66000000-01-01T00:00:00Z', 'imgURL' : 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'},
                       {'id': 'Q129290', 'label': 'Gryphaea', 'startTime': '-199600000-01-01T00:00:00Z','rankLabel':'genus', 'firstParentLabel': 'Gryphaeidae', 'endTime': '-33900000-01-01T00:00:00Z', 'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'},
                       {'id': 'Q130921', 'label': 'Abelisaurus', 'startTime': '-80000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Abelisauridae', 'endTime': '-80000000-01-01T00:00:00Z',  'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'},
                       {'id': 'Q129300', 'label': 'Inoceramus', 'startTime': '-189000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Inoceramidae','endTime': '-66000000-01-01T00:00:00Z',  'imgURL':'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'},
                       {'id': 'Q131298', 'label': 'Aardonyx', 'startTime': '-195000000-01-01T00:00:00Z','rankLabel': 'genus', 'firstParentLabel': 'Anchisauria', 'endTime': None, 'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Aardonyx%20NT.jpg'}]

    assert result == expected_result

def test_gives_right_format_without_rankLabel():
    '''Test the function returns the correct formatted data with missing rankLabel.'''
    data = {"head": {"vars": ['id', 'label', 'startTime', 'endTime', 'rankLabel', 'firstParentLabel', 'firstImgURL']}, 
            "results": {"bindings": 
                [
                {'id': {'type': 'literal', 'value': 'Q123245'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Leptoceratopsidae'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-83500000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Neoceratopsia'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q129290'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaea'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-199600000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-33900000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaeidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q130921'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisaurus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisauridae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'}}, 
                {'id': {'type': 'literal', 'value': 'Q129300'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-189000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}}
                ]
                }}
    result = timeline.format_data(data)

    expected_result = [{'id': 'Q123245', 'label': 'Leptoceratopsidae', 'startTime': '-83500000-01-01T00:00:00Z', 'rankLabel': None, 'firstParentLabel': 'Neoceratopsia', 'endTime': '-66000000-01-01T00:00:00Z', 'imgURL' : 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'},
                       {'id': 'Q129290', 'label': 'Gryphaea', 'startTime': '-199600000-01-01T00:00:00Z','rankLabel':'genus', 'firstParentLabel': 'Gryphaeidae', 'endTime': '-33900000-01-01T00:00:00Z', 'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'},
                       {'id': 'Q130921', 'label': 'Abelisaurus', 'startTime': '-80000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Abelisauridae', 'endTime': '-80000000-01-01T00:00:00Z',  'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'},
                       {'id': 'Q129300', 'label': 'Inoceramus', 'startTime': '-189000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Inoceramidae','endTime': '-66000000-01-01T00:00:00Z',  'imgURL':'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}]
    
    assert result == expected_result

def test_gives_right_format_without_parentLabel():
    '''Test the function returns the correct formatted data with missing firstParentLabel.'''
    data = {"head": {"vars": ['id', 'label', 'startTime', 'endTime', 'rankLabel', 'firstParentLabel', 'firstImgURL']}, 
            "results": {"bindings": 
                [
                {'id': {'type': 'literal', 'value': 'Q123245'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Leptoceratopsidae'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-83500000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'family'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q129290'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaea'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-199600000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-33900000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaeidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q130921'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisaurus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisauridae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'}}, 
                {'id': {'type': 'literal', 'value': 'Q129300'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-189000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}}
                ]
                }}
    result = timeline.format_data(data)

    expected_result = [{'id': 'Q123245', 'label': 'Leptoceratopsidae', 'startTime': '-83500000-01-01T00:00:00Z', 'rankLabel': 'family', 'firstParentLabel': None, 'endTime': '-66000000-01-01T00:00:00Z', 'imgURL' : 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'},
                       {'id': 'Q129290', 'label': 'Gryphaea', 'startTime': '-199600000-01-01T00:00:00Z','rankLabel':'genus', 'firstParentLabel': 'Gryphaeidae', 'endTime': '-33900000-01-01T00:00:00Z', 'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'},
                       {'id': 'Q130921', 'label': 'Abelisaurus', 'startTime': '-80000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Abelisauridae', 'endTime': '-80000000-01-01T00:00:00Z',  'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'},
                       {'id': 'Q129300', 'label': 'Inoceramus', 'startTime': '-189000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Inoceramidae','endTime': '-66000000-01-01T00:00:00Z',  'imgURL':'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}]
    
    assert result == expected_result


def test_gives_right_format_without_id():
    '''Test the function returns the correct formatted data with missing id.'''
    data = {"head": {"vars": ['id', 'label', 'startTime', 'endTime', 'rankLabel', 'firstParentLabel', 'firstImgURL']}, 
            "results": {"bindings": 
                [
                {'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Leptoceratopsidae'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-83500000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'family'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Neoceratopsia'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q129290'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaea'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-199600000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-33900000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Gryphaeidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'}}, 
                {'id': {'type': 'literal', 'value': 'Q130921'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisaurus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-80000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Abelisauridae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'}}, 
                {'id': {'type': 'literal', 'value': 'Q129300'}, 'label': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramus'}, 'startTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-189000000-01-01T00:00:00Z'}, 'endTime': {'datatype': 'http://www.w3.org/2001/XMLSchema#dateTime', 'type': 'literal', 'value': '-66000000-01-01T00:00:00Z'}, 'rankLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'genus'}, 'firstParentLabel': {'xml:lang': 'en', 'type': 'literal', 'value': 'Inoceramidae'}, 'firstImgURL': {'type': 'uri', 'value': 'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}}
                ]
                }}
    result = timeline.format_data(data, None, None, False)

    expected_result = [{'label': 'Leptoceratopsidae', 'startTime': '-83500000-01-01T00:00:00Z', 'rankLabel': 'family', 'firstParentLabel': 'Neoceratopsia', 'endTime': '-66000000-01-01T00:00:00Z', 'imgURL' : 'http://commons.wikimedia.org/wiki/Special:FilePath/Leptoceratopsidae%20Diversity.jpg'},
                       {'label': 'Gryphaea', 'startTime': '-199600000-01-01T00:00:00Z','rankLabel':'genus', 'firstParentLabel': 'Gryphaeidae', 'endTime': '-33900000-01-01T00:00:00Z', 'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Gryphaea%20arcuata%20fossil%20oyster%20%28Blue%20Lias%2C%20Lower%20Jurassic%3B%20coastal%20cliffs%20near%20Lyme%20Regis%2C%20far-western%20Dorset%20County%2C%20southwestern%20England%29%201%20%2815206675956%29.jpg'},
                       {'label': 'Abelisaurus', 'startTime': '-80000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Abelisauridae', 'endTime': '-80000000-01-01T00:00:00Z',  'imgURL': 'http://commons.wikimedia.org/wiki/Special:FilePath/Abelisaurus%20comahuensis.JPG'},
                       {'label': 'Inoceramus', 'startTime': '-189000000-01-01T00:00:00Z', 'rankLabel': 'genus', 'firstParentLabel': 'Inoceramidae','endTime': '-66000000-01-01T00:00:00Z',  'imgURL':'http://commons.wikimedia.org/wiki/Special:FilePath/InoceramusCretaceousSouthDakota.jpg'}]
    
    assert result == expected_result
